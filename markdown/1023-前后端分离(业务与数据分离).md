/*<<

 Title: 前后端分离(业务与数据分离)
 Date: 2016-02-05 21:09:26
 Tags: html, css, javascript, nodejs, backend
 Category: Front
 Sources:
   me: http://mpr0xy.com
>>*/

##前言

本篇文章主要讲解在实际工作中的前后端分离，其中分离的并不是普遍意义上的前端（浏览器端）和后端（服务器端）。而是多变的业务与稳定的基础数据开发的分离。


##问题的来源

为了快速开发前端页面和逻辑，和后端的沟通标准化，不用像开会似的和后端进行协商（这个过程可能非常久，非常频繁）。

应该让前端完全掌控整个页面的生命周期，做更多我们想做的事情，提高整个前端的用户体验和开发体验。

同时也提高了前端页面的复用性，因为不用管后端是什么在提供服务，只要接口标准是一样的就行。

咋一看，这哪里是问题，这分明是好处呀。对啊，如果没有这些好处，就会存在问题。一下把问题和好处都说完了。


##对应场景

我们有很多相对独立对活动需要做，每个活动可以看成是一个个单页APP。因为它们都有独立的逻辑和交互方式。但是它们的数据来源确实共同的，都是用户的走跑数据。

以前每开发一个活动，需要后端同学来编写这个活动的逻辑和数据接口。前端同学编写页面，通过这些数据接口完成页面的渲染和交互。开发流程就是前端同学和后端同学在同时开发，然后不停的商量和修改数据接口，接着开始调试，，需要两个人盯着，哪里不对改哪里。等到两人弄的差不多了，就会交给测试同学把玩。测试测出了问题，往往不知道是后端还是前端的问题（毕竟是黑盒手动测试）。就直接报给前端，前端分析后发现是后端的问题，再交由后端同学处理。

一个这样的活动，业务逻辑和交互比切相关。通常分为加入活动，累计数据，抽奖，分享，填写中奖信息等。这是每个活动的共同特征。其中累计数据才是后端同学应该重点处理的，其它业务应该由前端同学来统筹。


##解决方案

前端同学在后端提供稳定数据的基础上，新开辟了一层nodejs服务层（为什么用node是因为是js，前端同学学习成本极低）。

nodejs层负责三个功能:

-去后端取得业务需要使用的稳定数据

-存储和每个活动单独的数据(其实就是要实现活动的业务逻辑)

-渲染页面


nodejs层需要封装API层，来更好的使用后端提供的数据。目前使用的方式是，为每个请求提供一个API对象。这个API对象来提供业务层所需要的数据，同时也完成用户权限验证。API层实现对业务层隐藏。就算以后替换后端接口，也不影响调用API的业务层。

因为活动的需求变更会相对毕竟频繁，而且每个活动业务逻辑不一样，使用的数据库字段就会不一样，所以使用了mongoDB来存储每个活动的数据，这也可以在nodejs层不用写SQL就能完成数据库操作。

为了能控制页面渲染，同时又保持前端页面的独立性。使用了express的中间件机制，把前端目录作为了一个静态目录，当同时又可以在需要时，在静态请求返回之前进行拦截。而且把每个活动的前端页面作为一个npm包加入进项目里，一方面能很好的独立于这个nodejs服务，一方面能对前端页面进行很好对版本控制。








